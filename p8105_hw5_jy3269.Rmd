---
title: "p8105_hw5_jy3269"
author: "Jingyi Yao"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(gtsummary)
set.seed(1)
```



# Problem 2

### 1. Describe the Raw Data
```{r}
raw_data <- read_csv("./data/homicide-data.csv",show_col_types = FALSE)

dim(raw_data)

```


```{r}
raw_data %>% 
  select(-uid) %>% 
  tbl_summary(missing_text = "(Missing)", # counts missing values
  statistic = list(all_continuous() ~ "{mean} ({sd})")) %>%  # what to do with cont
  bold_labels() %>%
  italicize_levels()

```

### 2. Create a `city_state` Variable
```{r}
homicide <- raw_data %>% 
  mutate(city_state = str_c(city,", ",state),
         city_state = fct_inorder(city_state)) %>% 
  select(uid,city_state,everything())

head(homicide)

```

### 3. Summarize Within Cities
```{r}
homicide %>% 
  group_by(city_state) %>% 
  summarize(
    total_homicides = n(),
    unsolved_homicides = sum(disposition == "Open/No arrest") + sum(disposition == "Closed without arrest")) %>% 
  arrange(desc(total_homicides)) %>% 
  knitr::kable()

```


### 4. Focus on Baltimore, MD

```{r}
baltimore <- homicide %>% 
  filter(city_state == "Baltimore, MD") %>% 
  mutate(
    unresolved_homicides = ifelse(disposition == "Open/No arrest" | disposition == "Closed without arrest", 1,0)) 

```

#### 5. Conduct proportion test and saved the results
```{r}
result_baltimore <- prop.test(sum(baltimore$unresolved_homicides),length(baltimore$unresolved_homicides)) %>% 
  broom::tidy()

save(result_baltimore, file = "./results/results_baltimore.RData")
```

```{r}
prop_estimate_baltimore <- result_baltimore %>% 
  pull(estimate)

lower_bound_baltimore <- result_baltimore %>% 
  pull(conf.low)

upper_bound_baltimore <- result_baltimore %>% 
  pull(conf.high)

baltimore_estimate <- list(
  "proportion_estimate" = prop_estimate_baltimore,
  "lower_CI_estimate" = lower_bound_baltimore,
  "upper_CI_estimate" = upper_bound_baltimore
) %>% 
  bind_rows()

baltimore_estimate



```


```{r}


```


```{r}


```


```{r}


```


```{r}


```


```{r}


```


```{r}


```


```{r}


```


```{r}


```


```{r}


```


```{r}


```


```{r}


```


```{r}


```


```{r}


```


```{r}


```


```{r}


```